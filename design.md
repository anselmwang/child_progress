# 儿童学习进度追踪网站 - 完整设计文档

## 项目概述
这是一个帮助孩子记录和追踪学习进度的网站，特别针对AOPS（Art of Problem Solving）数学学习。使用Streamlit框架开发，提供简洁易用的界面。

## 核心功能需求

### 1. 日常进度输入
孩子每天可以输入两种学习进度：

#### AOPS学习进度
- 输入格式：逗号分隔的题号
- 题号规则：
  - **Problem（问题）**：只有一个"."的题号，例如：15.1
  - **Exercise（练习）**：有两个"."的题号，例如：15.1.5
- 当前书籍：固定为《Introduction to Algebra》，界面显示但不可编辑

#### 笔记
- 自由文本输入框
- 孩子可以记录当天做的其他学习活动

### 2. 数据验证规则

#### 格式验证
- 确保题号格式正确（Problem: X.Y，Exercise: X.Y.Z）
- 无效格式不允许更新，显示明确错误提示

#### 连续性验证
- **当天连续性**：同一天输入的题目必须连续
  - 正确示例：15.1, 15.2 ✓
  - 错误示例：15.1, 15.3 ✗
- **跨天连续性**：今天的第一题必须紧接昨天的最后一题
  - 如果今天第一题是15.2，昨天必须已经完成15.1

#### 通用连续性规则
同类型题目（Problem或Exercise）在以下三种情况下视为连续：

1. **正常递增**：
   - Problem: 15.1 → 15.2 → 15.3
   - Exercise: 15.1.1 → 15.1.2 → 15.1.3

2. **跨section连续**（仅适用于Exercise）：
   - 例如：15.1.5 → 15.2.1
   - 当一个section的练习题结束时，可以跳转到下一个section的第一道练习题

3. **跨chapter连续**（适用于Problem和Exercise）：
   - Problem: 15.30 → 16.1（当第15章的最后一个problem时）
   - Exercise: 15.5.5 → 16.1.1（当第15章最后一节的最后一个exercise时）
   - 系统自动识别章节结束，无需预设每章的题目数量

### 3. 用户体验设计

#### 日期选择
- 可以选择任意日期进行输入/编辑
- 提供"今天"按钮，快速跳转到当前日期
- 同一天可以无限次更新进度

#### 用户管理
- 单个孩子使用，无需登录系统
- 父母可以直接访问查看进度
- 使用本地时区处理时间

## 页面结构

### 主导航
侧边栏包含三个选项：
- 📝 **输入进度**
- 📊 **概览页面**
- 📋 **详情页面**

### 1. 输入进度页面
- **日期选择器**：带"今天"快捷按钮
- **当前书籍显示**："当前书籍：Introduction to Algebra"
- **题目输入框**：逗号分隔的题号输入
- **笔记文本框**：自由文本输入
- **更新进度按钮**：提交/更新当天进度
- **验证反馈**：实时显示验证错误信息

### 2. 概览页面

#### 缺失日期提醒
- 页面顶部显示最近14天内缺失的记录
- 格式："⚠️ 缺失记录：10月2日, 10月3日"（可点击跳转到输入页面）

#### 激励功能
- **每周总结**："本周你完成了X道问题和Y道练习！🌟"
- **章节里程碑**：完成章节时显示庆祝信息，例如："第15章完成！🎉"

#### 三张曲线图
每张图显示三条曲线：
- Problem数量变化
- Exercise数量变化
- Problem + Exercise总数变化

图表时间范围：从最早数据到最新数据
- **日聚合图表**：按天统计
- **周聚合图表**：按周统计
- **月聚合图表**：按月统计

### 3. 详情页面
- 时间顺序列表显示所有进度记录
- 每条记录包含：
  - 日期
  - 完成的AOPS题目
  - 当天笔记
- 简洁的表格或列表格式展示

## 技术架构

### 开发框架
- **主框架**：Streamlit (Python)
- **图表库**：Plotly（用于交互式图表）
- **部署方式**：可本地运行或部署到Streamlit Cloud

### 数据存储
- **格式**：JSONL（每行一个JSON对象）
- **存储位置**：服务器端文件
- **数据可靠性保障**：
  - **原子写入策略**：使用临时文件写入后原子替换，防止写入过程中断导致的数据损坏
  - **自动备份机制**：每次数据写入时自动创建时间戳备份文件，无需用户干预
  - **备份管理**：自动清理旧备份文件，保留最近的指定数量备份
- **数据结构示例**：
```json
{
  "date": "2025-01-04",
  "problems": ["15.1", "15.2"],
  "exercises": ["14.2.1", "14.2.2"],
  "notes": "复习了前面的内容",
  "book": "Introduction to Algebra"
}
```

### 应用结构
```
child_progress/
├── app.py              # 主Streamlit应用
├── data/
│   ├── progress.jsonl  # 主数据存储文件
│   └── backups/        # 自动备份文件目录
│       ├── progress_backup_20250104_143022.jsonl
│       ├── progress_backup_20250104_150033.jsonl
│       └── ...
├── utils/
│   ├── validation.py   # 验证逻辑
│   ├── data_handler.py # JSONL文件操作（包含原子写入和备份逻辑）
│   └── charts.py       # 图表生成
└── requirements.txt    # 依赖包列表
```

## 核心实现逻辑

### 数据验证模块
```python
def validate_continuity(today_items, previous_items):
    # 检查当天连续性
    # 检查跨天连续性
    # 返回 (是否有效, 错误信息)
```

### Streamlit特性应用
- 使用 `st.session_state` 在会话期间保持数据
- `st.date_input` 用于日期选择（最大值为今天）
- `st.success()` / `st.error()` 提供用户反馈
- `st.plotly_chart()` 显示交互式图表
- `st.metric()` 展示激励信息

### 激励系统实现
- **每周统计**：计算本周完成的题目总数
- **章节检测**：识别章节完成情况并显示庆祝消息
- **视觉反馈**：使用emoji和颜色增强用户体验

## 设计原则
- **简洁性**：界面简单易用，适合儿童操作
- **即时反馈**：输入错误时立即显示清晰的错误信息
- **激励性**：通过每周总结和里程碑庆祝激发学习动力
- **灵活性**：支持任意日期的进度输入和编辑
- **持久性**：数据保存在JSONL文件中，确保数据不丢失
- **可靠性**：通过原子写入和自动备份机制，防止数据损坏和丢失
- **透明性**：数据保护机制在后台自动运行，不干扰用户体验

## 用户流程
1. **首次访问**：选择"输入进度"开始记录
2. **日常使用**：点击"今天"按钮快速输入当天进度
3. **查看进展**：通过"概览"页面查看图表和统计信息
4. **回顾历史**：在"详情"页面浏览所有历史记录
5. **补录数据**：选择任意日期补充或修改之前的记录

这个设计确保了应用既功能完整又易于使用，能够有效帮助孩子建立良好的学习记录习惯。
